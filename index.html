<!DOCTYPE html>
<html lang="fr" data-theme="light">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>WeMaintenance – Outil Coordinateurs</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap');

:root {
  --bg:#f0f2f5; --surface:#fff; --surface2:#f6f7f9; --border:#e4e7ec;
  --text:#111827; --muted:#6b7280; --accent:#2563eb; --accent-light:#eff6ff;
  --green:#16a34a; --green-light:#f0fdf4; --red:#dc2626; --orange:#ea580c;
  --purple:#7c3aed; --amber:#d97706; --radius:10px;
  --shadow:0 1px 2px rgba(0,0,0,.05),0 4px 12px rgba(0,0,0,.04);
  --shadow-hover:0 2px 6px rgba(0,0,0,.08),0 8px 20px rgba(0,0,0,.06);
  --mono-bg:#f6f7f9; --info-bg:#eff6ff; --info-border:#bfdbfe; --info-text:#1d4ed8;
}
[data-theme="dark"] {
  --bg:#2c2f3a; --surface:#363b4a; --surface2:#3f4555; --border:#505670;
  --text:#eceef5; --muted:#9ba3b8; --accent:#7fb3ff; --accent-light:#323c5a;
  --green:#6ee79a; --green-light:#1e3d2e; --red:#fc9090; --orange:#fdaa6e;
  --purple:#c4affe; --amber:#fdd068;
  --shadow:0 1px 3px rgba(0,0,0,.15),0 4px 12px rgba(0,0,0,.1);
  --shadow-hover:0 2px 8px rgba(0,0,0,.2),0 8px 24px rgba(0,0,0,.15);
  --mono-bg:#2a2e3b; --info-bg:#2d3654; --info-border:#3d508a; --info-text:#a8c4ff;
}

*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Outfit',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;font-size:14px;line-height:1.55;transition:background .3s,color .3s;-webkit-font-smoothing:antialiased}

/* HEADER */
.header{background:var(--surface);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:100;transition:background .3s,border-color .3s}
.header-inner{max-width:1200px;margin:0 auto;padding:13px 24px;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
.logo-row{display:flex;align-items:center;gap:12px}
.logo-icon{width:38px;height:38px;background:var(--accent);border-radius:9px;display:flex;align-items:center;justify-content:center;flex-shrink:0;color:white}
.logo-title{font-size:16px;font-weight:700;letter-spacing:-.2px}
.logo-sub{font-size:11.5px;color:var(--muted);margin-top:1px}
.header-right{display:flex;align-items:center;gap:10px;flex-wrap:wrap}

/* FILTER TABS */
.filter-tabs{display:flex;background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:3px;gap:2px;transition:background .3s,border-color .3s}
.filter-tab{padding:5px 12px;border:none;background:none;border-radius:6px;font-family:'Outfit',sans-serif;font-size:12.5px;font-weight:500;cursor:pointer;color:var(--muted);transition:all .2s;display:flex;align-items:center;gap:6px;white-space:nowrap}
.filter-tab.active{background:var(--surface);color:var(--text);box-shadow:0 1px 3px rgba(0,0,0,.1)}
.filter-tab svg{width:13px;height:13px;flex-shrink:0}

/* PAGE NAV */
.page-nav{display:flex;background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:3px;gap:2px;transition:background .3s,border-color .3s}
.page-tab{padding:5px 14px;border:none;background:none;border-radius:6px;font-family:'Outfit',sans-serif;font-size:12.5px;font-weight:500;cursor:pointer;color:var(--muted);transition:all .2s;display:flex;align-items:center;gap:6px;white-space:nowrap}
.page-tab.active{background:var(--surface);color:var(--text);box-shadow:0 1px 3px rgba(0,0,0,.1)}
.page-tab svg{width:13px;height:13px;flex-shrink:0}

/* DARK TOGGLE */
.dark-toggle{width:34px;height:34px;border:1px solid var(--border);background:var(--surface);border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--muted);transition:all .2s;flex-shrink:0}
.dark-toggle:hover{background:var(--surface2);color:var(--text)}
.dark-toggle svg{width:16px;height:16px}

/* PAGES */
.page{display:none}.page.active{display:block}

/* MAIN */
.main{max-width:1200px;margin:0 auto;padding:20px 24px 52px;display:flex;flex-direction:column;gap:14px}

/* CARD */
.card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);transition:box-shadow .2s,background .3s,border-color .3s}
.card:hover{box-shadow:var(--shadow-hover)}

/* INFO BANNER */
.info-banner{background:var(--info-bg);border:1px solid var(--info-border);border-radius:var(--radius);padding:12px 16px;display:flex;align-items:flex-start;gap:10px;font-size:13px;color:var(--info-text);transition:background .3s,border-color .3s}
.info-banner svg{width:16px;height:16px;flex-shrink:0;margin-top:1px;color:var(--accent)}
.info-banner strong{font-weight:600}
.info-banner-items{display:flex;flex-direction:column;gap:3px}

/* STATS */
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
.stat-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:14px 16px;box-shadow:var(--shadow);transition:box-shadow .2s,background .3s,border-color .3s}
.stat-card:hover{box-shadow:var(--shadow-hover)}
.stat-label{font-size:11px;color:var(--muted);font-weight:500;margin-bottom:7px;display:flex;align-items:center;gap:6px;text-transform:uppercase;letter-spacing:.4px}
.stat-label svg{width:12px;height:12px}
.stat-value{font-size:28px;font-weight:700;line-height:1;letter-spacing:-.5px}
.c-gray{color:var(--text)} .c-green{color:var(--green)} .c-red{color:var(--red)} .c-orange{color:var(--orange)}

/* PROGRESS */
.progress-card{padding:18px 20px}
.progress-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
.progress-title{font-size:13px;font-weight:600;display:flex;align-items:center;gap:7px;color:var(--text)}
.progress-title svg{width:15px;height:15px;color:var(--accent)}
.progress-count{font-size:12px;color:var(--muted)}
.progress-bar-bg{height:6px;background:var(--bg);border-radius:99px;overflow:hidden;transition:background .3s}
.progress-bar-fill{height:100%;background:linear-gradient(90deg,var(--accent) 0%,var(--purple) 100%);border-radius:99px;transition:width .5s ease}
.progress-pct{margin-top:7px;text-align:right;font-size:20px;font-weight:700;color:var(--accent);letter-spacing:-.5px}

/* SECTION CARD */
.section-card{overflow:hidden}
.section-header{width:100%;padding:12px 16px;background:none;border:none;cursor:pointer;display:flex;align-items:center;justify-content:space-between;font-family:'Outfit',sans-serif;transition:background .15s;text-align:left}
.section-header:hover{background:var(--surface2)}
.section-header-left{display:flex;align-items:center;gap:9px;flex-wrap:wrap}
.section-chevron{color:var(--muted);transition:transform .2s;flex-shrink:0;display:flex}
.section-chevron svg{width:14px;height:14px}
.section-chevron.open{transform:rotate(90deg)}
.section-title{font-size:13.5px;font-weight:600;color:var(--text);display:flex;align-items:center;gap:7px}
.section-title svg{width:15px;height:15px;flex-shrink:0}
.section-header-right{display:flex;align-items:center;gap:7px;flex-shrink:0}
.section-count{font-size:12px;color:var(--muted)}
.section-pct{font-size:11px;font-weight:600;padding:2px 9px;background:var(--bg);border-radius:99px;color:var(--muted);border:1px solid var(--border);transition:background .3s,border-color .3s}
.color-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0}
.dot-red{background:var(--red)} .dot-green{background:var(--green)} .dot-purple{background:var(--purple)} .dot-blue{background:var(--accent)} .dot-orange{background:var(--orange)}
.section-body{border-top:1px solid var(--border);padding:6px 10px;display:flex;flex-direction:column;gap:1px;transition:border-color .3s}
.section-body.hidden{display:none}

/* TASK ROW */
.task-row{display:flex;align-items:flex-start;gap:10px;padding:8px 7px;border-radius:7px;transition:background .15s;user-select:none;position:relative}
.task-row:hover{background:var(--surface2)}
.task-row.ko-row{background:rgba(220,38,38,.06)}
.task-row.ko-row:hover{background:rgba(220,38,38,.1)}
.task-checkbox{width:16px;height:16px;border:1.5px solid var(--border);border-radius:4px;flex-shrink:0;margin-top:2px;display:flex;align-items:center;justify-content:center;transition:all .15s;background:var(--surface);cursor:pointer;position:relative}
.task-checkbox.checked{background:var(--accent);border-color:var(--accent)}
.task-checkbox.checked::after{content:'';display:block;width:4px;height:8px;border:1.5px solid white;border-top:none;border-left:none;transform:rotate(45deg) translateY(-1px)}
.task-checkbox.ko-state{background:var(--red);border-color:var(--red)}
.task-checkbox.ko-state::before,.task-checkbox.ko-state::after{content:'';position:absolute;width:8px;height:1.5px;background:white;border-radius:1px}
.task-checkbox.ko-state::before{transform:rotate(45deg)}
.task-checkbox.ko-state::after{transform:rotate(-45deg)}
.task-label{font-size:13px;color:var(--text);line-height:1.45;flex:1;transition:color .15s;cursor:pointer;font-weight:400}
.task-label.done{color:var(--muted);text-decoration:line-through}
.task-label.ko-label{color:var(--red)}
.ko-badge{font-size:10px;font-weight:700;color:var(--red);background:rgba(220,38,38,.1);border:1px solid rgba(220,38,38,.25);border-radius:4px;padding:1px 6px;flex-shrink:0;margin-top:2px}
.ko-btn{flex-shrink:0;width:22px;height:22px;border:1px solid var(--border);background:var(--surface);cursor:pointer;border-radius:5px;display:flex;align-items:center;justify-content:center;color:var(--muted);opacity:0;transition:opacity .15s,background .15s,color .15s,border-color .15s;padding:0}
.ko-btn svg{width:12px;height:12px}
.task-row:hover .ko-btn{opacity:1}
.task-row.ko-row .ko-btn{opacity:1;color:var(--red);border-color:rgba(220,38,38,.3);background:rgba(220,38,38,.08)}
.ko-btn:hover{background:rgba(220,38,38,.12)!important;color:var(--red)!important;border-color:rgba(220,38,38,.3)!important}

/* EMAIL CARD */
.email-card{padding:18px 20px}
.card-title{font-size:14px;font-weight:700;display:flex;align-items:center;gap:8px;margin-bottom:14px;letter-spacing:-.1px}
.card-title svg{width:16px;height:16px;color:var(--accent);flex-shrink:0}
.card-sub{font-size:11px;font-weight:600;color:var(--muted);margin-bottom:7px;text-transform:uppercase;letter-spacing:.6px;display:flex;align-items:center;gap:5px}
.card-sub svg{width:12px;height:12px}
.email-instructions{background:var(--surface2);border-radius:8px;padding:12px 14px;margin-bottom:14px;display:flex;flex-direction:column;gap:6px;transition:background .3s}
.email-instructions p{font-size:13px;color:var(--text);display:flex;align-items:flex-start;gap:7px}
.email-instructions p svg{width:14px;height:14px;color:var(--muted);flex-shrink:0;margin-top:2px}
.email-instructions strong{font-weight:600;margin-right:2px}
.mono-wrap{position:relative;margin-bottom:14px}
.mono-block{background:var(--mono-bg);border:1px solid var(--border);border-radius:8px;padding:12px 80px 12px 14px;font-family:'IBM Plex Mono',monospace;font-size:12px;color:var(--text);white-space:pre-wrap;line-height:1.65;transition:background .3s,border-color .3s,color .3s}
.bullet-item{display:block;color:var(--accent);font-weight:600;letter-spacing:.1px;line-height:1.65}
.copy-btn{position:absolute;top:8px;right:8px;padding:4px 10px;font-size:11.5px;font-weight:600;border:1px solid var(--border);background:var(--surface);color:var(--muted);border-radius:6px;cursor:pointer;display:flex;align-items:center;gap:5px;transition:all .2s;font-family:'Outfit',sans-serif;white-space:nowrap}
.copy-btn svg{width:12px;height:12px}
.copy-btn:hover{background:var(--accent);color:white;border-color:var(--accent)}
.copy-btn.copied{background:var(--green);color:white;border-color:var(--green)}

/* INFO CARDS GRID */
.info-section-wrapper{display:flex;flex-direction:column;gap:10px}
.info-section-heading{font-size:12px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:.6px;display:flex;align-items:center;gap:7px;padding:0 2px}
.info-section-heading svg{width:14px;height:14px}
.info-cards-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.info-card{border-radius:var(--radius);padding:14px 16px;border:1px solid transparent;transition:background .3s,border-color .3s}
.info-card-header{display:flex;align-items:center;gap:9px;margin-bottom:8px}
.info-card-icon{width:28px;height:28px;border-radius:7px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.info-card-icon svg{width:14px;height:14px}
.info-card-label{font-size:12px;font-weight:700;letter-spacing:.2px;text-transform:uppercase}
.info-card-text{font-size:12.5px;line-height:1.55}
.info-card-text strong{font-weight:600}
.info-card--blue{background:var(--info-bg);border-color:var(--info-border)}
.info-card--blue .info-card-icon{background:rgba(37,99,235,.15);color:var(--accent)}
.info-card--blue .info-card-label{color:var(--accent)}
.info-card--blue .info-card-text{color:var(--info-text)}
.info-card--red{background:rgba(220,38,38,.06);border-color:rgba(220,38,38,.18)}
.info-card--red .info-card-icon{background:rgba(220,38,38,.12);color:var(--red)}
.info-card--red .info-card-label{color:var(--red)}
.info-card--red .info-card-text{color:var(--text)}
.info-card--green{background:rgba(22,163,74,.06);border-color:rgba(22,163,74,.18)}
.info-card--green .info-card-icon{background:rgba(22,163,74,.12);color:var(--green)}
.info-card--green .info-card-label{color:var(--green)}
.info-card--green .info-card-text{color:var(--text)}
.info-card--amber{background:rgba(217,119,6,.06);border-color:rgba(217,119,6,.2)}
.info-card--amber .info-card-icon{background:rgba(217,119,6,.12);color:var(--amber)}
.info-card--amber .info-card-label{color:var(--amber)}
.info-card--amber .info-card-text{color:var(--text)}

/* COMPLETE BANNER */
.complete-banner{background:var(--green-light);border:1px solid rgba(22,163,74,.2);border-radius:var(--radius);padding:12px 16px;display:none;align-items:center;gap:10px;font-size:13.5px;font-weight:600;color:var(--green);transition:background .3s}
.complete-banner svg{width:18px;height:18px;flex-shrink:0}
.complete-banner.visible{display:flex}

.footer{text-align:center;font-size:11.5px;color:var(--muted);padding:20px 0 0}

/* EMAIL SECURITY – PIN */
.email-send-line{display:inline}
.email-reveal-btn{display:inline-flex;align-items:center;gap:5px;padding:3px 10px;font-size:12px;font-weight:600;font-family:'Outfit',sans-serif;background:var(--accent-light);color:var(--accent);border:1px solid var(--info-border);border-radius:99px;cursor:pointer;transition:all .2s;vertical-align:middle;margin:0 4px}
.email-reveal-btn:hover{background:var(--accent);color:white;border-color:var(--accent)}
.email-reveal-btn svg{flex-shrink:0}
.pin-overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:1000;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(4px);animation:overlayIn .15s ease}
@keyframes overlayIn{from{opacity:0}to{opacity:1}}
.pin-modal{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:28px 32px;width:320px;box-shadow:0 20px 60px rgba(0,0,0,.2);animation:modalIn .2s cubic-bezier(.34,1.56,.64,1)}
@keyframes modalIn{from{opacity:0;transform:scale(.92)}to{opacity:1;transform:scale(1)}}
.pin-modal-header{display:flex;align-items:center;gap:10px;margin-bottom:6px}
.pin-modal-icon{width:36px;height:36px;background:var(--accent-light);border-radius:9px;display:flex;align-items:center;justify-content:center;color:var(--accent);flex-shrink:0}
.pin-modal-icon svg{width:18px;height:18px}
.pin-modal-title{font-size:15px;font-weight:700;color:var(--text)}
.pin-modal-sub{font-size:12.5px;color:var(--muted);margin-bottom:18px;line-height:1.5}
.pin-dots{display:flex;justify-content:center;gap:10px;margin-bottom:18px}
.pin-dot{width:14px;height:14px;border-radius:50%;border:2px solid var(--border);background:var(--surface2);transition:all .15s}
.pin-dot.filled{background:var(--accent);border-color:var(--accent)}
.pin-dot.error{background:var(--red);border-color:var(--red)}
.pin-pad{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:16px}
.pin-key{padding:12px 8px;font-size:17px;font-weight:600;font-family:'Outfit',sans-serif;background:var(--surface2);border:1px solid var(--border);border-radius:9px;cursor:pointer;color:var(--text);transition:all .15s;text-align:center}
.pin-key:hover{background:var(--accent);color:white;border-color:var(--accent);transform:scale(1.04)}
.pin-key:active{transform:scale(.97)}
.pin-key.del{font-size:13px;color:var(--muted)}
.pin-key.del:hover{background:rgba(220,38,38,.1);color:var(--red);border-color:rgba(220,38,38,.3)}
.pin-error-msg{font-size:12px;color:var(--red);text-align:center;min-height:16px;font-weight:500;margin-bottom:8px}
.pin-cancel{width:100%;padding:9px;font-size:12.5px;font-weight:500;font-family:'Outfit',sans-serif;background:none;border:1px solid var(--border);border-radius:8px;cursor:pointer;color:var(--muted);transition:all .2s}
.pin-cancel:hover{background:var(--surface2);color:var(--text)}
.email-chips{display:inline-flex;flex-wrap:wrap;align-items:center;gap:5px;vertical-align:middle;margin:0 2px;animation:fadeIn .25s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(-2px)}to{opacity:1;transform:translateY(0)}}
.email-chip{display:inline-flex;align-items:center;gap:5px;padding:2px 9px;font-size:11.5px;font-weight:500;font-family:'IBM Plex Mono',monospace;background:var(--accent-light);border:1px solid var(--info-border);border-radius:5px;color:var(--accent);cursor:pointer;letter-spacing:-.2px;transition:all .15s;position:relative}
.email-chip:not(.static):hover{background:var(--accent);color:white;border-color:var(--accent)}
.email-chip.chip-copied{background:var(--green)!important;color:white!important;border-color:var(--green)!important}
.email-chip.static{color:var(--muted);font-family:'Outfit',sans-serif;font-size:12px;background:var(--surface2);border-color:var(--border)}
.email-hide-btn,.email-copy-all-btn{display:inline-flex;align-items:center;gap:4px;padding:2px 8px;font-size:11px;font-weight:600;font-family:'Outfit',sans-serif;background:none;border:1px solid var(--border);border-radius:99px;cursor:pointer;transition:all .2s}
.email-hide-btn{color:var(--muted)}
.email-hide-btn:hover{color:var(--red);border-color:rgba(220,38,38,.3);background:rgba(220,38,38,.06)}
.email-copy-all-btn{color:var(--accent);border-color:var(--info-border)}
.email-copy-all-btn:hover{background:var(--accent);color:white;border-color:var(--accent)}
.email-copy-all-btn.copied{background:var(--green);color:white;border-color:var(--green)}

/* VERIF — STATUS TOGGLE */
.status-card{padding:14px 16px}
.status-card-title{font-size:11px;font-weight:600;color:var(--muted);margin-bottom:10px;text-transform:uppercase;letter-spacing:.5px}
/* VERIF — CATEGORY */
.cat-card{padding:0;overflow:hidden}
.cat-header{padding:12px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:9px;transition:border-color .3s}
.cat-badge{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;padding:2px 9px;border-radius:99px;border:1px solid}
.cat-badge.common{color:var(--accent);background:var(--accent-light);border-color:var(--info-border)}
.cat-badge.ok{color:var(--green);background:rgba(22,163,74,.08);border-color:rgba(22,163,74,.25)}
.cat-badge.sav{color:var(--red);background:rgba(220,38,38,.06);border-color:rgba(220,38,38,.2)}
.cat-body{padding:8px 10px;display:flex;flex-direction:column;gap:6px}
/* VERIF — ORGANIGRAMME */
.orga-card{padding:18px 20px;background:var(--info-bg)!important;border-color:var(--info-border)!important;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px}
.orga-text{font-size:13px;color:var(--info-text);font-weight:500}
.orga-btn{display:inline-flex;align-items:center;gap:7px;padding:8px 16px;background:var(--accent);color:white;border:none;border-radius:8px;font-family:'Outfit',sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:all .2s;text-decoration:none}
.orga-btn:hover{opacity:.88;transform:translateY(-1px)}
.orga-btn svg{width:14px;height:14px}
/* VERIF — COMPLETE BANNER */
.verif-complete{background:var(--green-light);border:1px solid rgba(22,163,74,.2);border-radius:var(--radius);padding:12px 16px;display:none;align-items:center;gap:10px;font-size:13.5px;font-weight:600;color:var(--green)}
.verif-complete.visible{display:flex}
.verif-complete svg{width:18px;height:18px;flex-shrink:0}

/* RESPONSIVE */
@media(max-width:860px){
  .header-right{width:100%;justify-content:space-between}
  .page-nav,.filter-tabs{flex:1}
}
@media(max-width:600px){
  .header-inner{padding:10px 14px}
  .logo-sub{display:none}
  .page-tab,.filter-tab{padding:5px 8px;font-size:11.5px}
  .stats-grid{grid-template-columns:repeat(2,1fr)}
  .info-cards-grid{grid-template-columns:1fr}
  .main{padding:14px 14px 40px}
  .orga-card{flex-direction:column;align-items:flex-start}
  .orga-btn{width:100%;justify-content:center}
  .email-chips{flex-direction:column;align-items:flex-start}
}
@media(max-width:380px){
  .stats-grid{grid-template-columns:1fr 1fr}
  .page-tab svg,.filter-tab svg{display:none}
}
</style>
</head>
<body>

<header class="header">
  <div class="header-inner">
    <div class="logo-row">
      <div class="logo-icon">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
      </div>
      <div>
        <div class="logo-title" id="header-title">Traitement des Prépas</div>
        <div class="logo-sub" id="header-sub">Suivez chaque étape pour un traitement optimal</div>
      </div>
    </div>
    <div class="header-right">
      <div class="page-nav">
        <button class="page-tab active" id="nav-prepas">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>
          Traitement Prépas
        </button>
        <button class="page-tab" id="nav-verif">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
          Vérification Site
        </button>
      </div>
      <div class="filter-tabs">
        <button class="filter-tab active" id="tab-all">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
          Toutes
        </button>
        <button class="filter-tab" id="tab-pending">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
          À faire
        </button>
        <button class="filter-tab" id="tab-ko" style="color:var(--red)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
          KO
        </button>
      </div>
      <button class="dark-toggle" id="dark-btn" title="Basculer thème">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
      </button>
    </div>
  </div>
</header>

<!-- PAGE 1: TRAITEMENT DES PRÉPAS -->
<div id="page-prepas" class="page active">
<main class="main">

  <div class="info-banner">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
    <div class="info-banner-items">
      <span><strong>Objectif :</strong> Traiter complètement chaque prépa reçue avant envoi</span>
    </div>
  </div>

  <div class="complete-banner" id="complete-banner">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
    Toutes les tâches sont complétées ! Vous pouvez envoyer le mail de traitement.
  </div>

  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-label">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
        Total
      </div>
      <div class="stat-value c-gray" id="stat-total">0</div>
    </div>
    <div class="stat-card">
      <div class="stat-label" style="color:var(--green)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
        Complétées
      </div>
      <div class="stat-value c-green" id="stat-done">0</div>
    </div>
    <div class="stat-card">
      <div class="stat-label" style="color:var(--red)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
        KO
      </div>
      <div class="stat-value c-red" id="stat-ko">0</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        En attente
      </div>
      <div class="stat-value c-orange" id="stat-pending">0</div>
    </div>
  </div>

  <div class="card progress-card">
    <div class="progress-header">
      <span class="progress-title">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
        Progression globale
      </span>
      <span class="progress-count" id="progress-count">0 / 0 tâches</span>
    </div>
    <div class="progress-bar-bg"><div class="progress-bar-fill" id="progress-bar" style="width:0%"></div></div>
    <div class="progress-pct" id="progress-pct">0%</div>
  </div>

  <div id="sections-main" style="display:flex;flex-direction:column;gap:12px"></div>

  <div id="sections-mail"></div>

  <div class="card email-card">
    <div class="card-title">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
      Instructions d’utilisation
    </div>
    <div class="email-instructions">
      <p>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
        <span><strong>Quand utiliser :</strong> Lors du lancement d’un nouveau projet web</span>
      </p>
      <p>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
        <span class="email-send-line"><strong>Où envoyer :</strong> Gmail &rarr;
          <button class="email-reveal-btn" id="reveal-emails-btn">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
            Afficher les destinataires (4)
          </button>
          <span class="email-chips" id="email-list" style="display:none">
            <span class="email-chip" data-a="NnQoNT0/Oy8aOz0/NDk/" data-b="dzk1Mj8oPzQ5P3Q8KA==">•••</span>
            <span class="email-chip" data-a="N3Q4NS8uPywzNBo7PT80" data-b="OT93OTUyPyg/NDk/dDwo">•••</span>
            <span class="email-chip" data-a="Nz8yPjN0KXQ5NTI/KD" data-b="80OT8aPTc7MzZ0OTU3">•••</span>
            <span class="email-chip" data-a="OzYzdDV0OTUyPyg/ND" data-b="k/Gj03OzM2dDk1Nw==">•••</span>
            <span class="email-chip static">CDP</span>
            <span class="email-chip static">Assistante co (Maroc)</span>
            <button class="email-copy-all-btn" id="copy-emails-btn">
              <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
              Copier tous
            </button>
            <button class="email-hide-btn" id="hide-emails-btn">
              <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19M1 1l22 22"/></svg>
              Masquer
            </button>
          </span>
        </span>
      </p>
      <p>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14M4.93 4.93a10 10 0 0 0 0 14.14"/></svg>
        <span><strong>Actions requises :</strong> Renseigner le pack, les options payantes et les frais techniques</span>
      </p>
    </div>

    <div class="card-sub">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/></svg>
      Sujet de l’email
    </div>
    <div class="mono-wrap">
      <div class="mono-block" id="email-subject">Traitement prépa - [NOM DU COMPTE CLIENT]</div>
      <button class="copy-btn" id="copy-subject">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
        Copier
      </button>
    </div>

    <div class="card-sub">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
      Contenu du message
    </div>
    <div class="mono-wrap">
      <div class="mono-block" id="email-body-display" aria-hidden="true">Bonjour,

Pack site web démo :

<span class="bullet-item">▸ [Options payantes supplémentaires]</span><span class="bullet-item">▸ Frais techniques = [XXX]€</span><span class="bullet-item">▸ [Rachat]</span><span class="bullet-item">▸ SEO : Pack [xx] top [xx]</span>
Lien de la Fiche prépa en complément d’info</div>
      <textarea class="mono-block" id="email-body" style="display:none;resize:none;height:0;overflow:hidden" readonly>Bonjour,

Pack site web démo :

▸ [Options payantes supplémentaires]
▸ Frais techniques = [XXX]€
▸ [Rachat]
▸ SEO : Pack [xx] top [xx]
Lien de la Fiche prépa en complément d’info</textarea>
      <button class="copy-btn" id="copy-body">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
        Copier
      </button>
    </div>
  </div>

  <div class="info-section-wrapper">
    <div class="info-section-heading">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
      Informations complémentaires
    </div>
    <div class="info-cards-grid">
      <div class="info-card info-card--blue">
        <div class="info-card-header">
          <div class="info-card-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></div>
          <div class="info-card-label">Délai</div>
        </div>
        <div class="info-card-text"><strong>48h ouvrées</strong> maximum pour traiter chaque prépa reçue.</div>
      </div>
      <div class="info-card info-card--red">
        <div class="info-card-header">
          <div class="info-card-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg></div>
          <div class="info-card-label">Attention</div>
        </div>
        <div class="info-card-text">Produit <strong>SEO</strong> vendu → contacter le CDP avant toute modification.</div>
      </div>
      <div class="info-card info-card--green">
        <div class="info-card-header">
          <div class="info-card-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg></div>
          <div class="info-card-label">Conseil</div>
        </div>
        <div class="info-card-text">Cocher les tâches <strong>progressivement</strong> au fur et à mesure du traitement.</div>
      </div>
      <div class="info-card info-card--amber">
        <div class="info-card-header">
          <div class="info-card-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg></div>
          <div class="info-card-label">Imputation</div>
        </div>
        <div class="info-card-text">Libeller l’imputation <strong>« traitement prepa »</strong> dans l’outil de suivi.</div>
      </div>
    </div>
  </div>

  <div class="footer">© 2026 Cohérence Maintenance — Outils de maintenance et développement</div>
</main>
</div>

<!-- PAGE 2: VÉRIFICATION SITE -->
<div id="page-verif" class="page">
<main class="main" id="verif-main"></main>
</div>

<script>
// ══════════════════════════════════════════════
// THEME
// ══════════════════════════════════════════════
function toggleDark() {
  var html = document.documentElement;
  var isDark = html.getAttribute('data-theme') === 'dark';
  html.setAttribute('data-theme', isDark ? 'light' : 'dark');
}
document.getElementById('dark-btn').addEventListener('click', toggleDark);

// ══════════════════════════════════════════════
// PAGE NAVIGATION
// ══════════════════════════════════════════════
function showPage(page) {
  document.getElementById('page-prepas').classList.toggle('active', page === 'prepas');
  document.getElementById('page-verif').classList.toggle('active', page === 'verif');
  document.getElementById('nav-prepas').classList.toggle('active', page === 'prepas');
  document.getElementById('nav-verif').classList.toggle('active', page === 'verif');
  document.getElementById('header-title').textContent = page === 'prepas' ? 'Traitement des Prépas' : 'Vérification de Site';
  document.getElementById('header-sub').textContent = page === 'prepas' ? 'Suivez chaque étape pour un traitement optimal' : 'Contrôle qualité avant livraison';
  if (page === 'verif' && !verifInitialized) { initVerif(); verifInitialized = true; }
}
document.getElementById('nav-prepas').addEventListener('click', function() { showPage('prepas'); });
document.getElementById('nav-verif').addEventListener('click', function() { showPage('verif'); });

// ══════════════════════════════════════════════
// PAGE 1 — TRAITEMENT DES PRÉPAS
// ══════════════════════════════════════════════
var SECTIONS = [
  { id:'prerequis', title:'Pré-requis', icon:'check', color:'blue', tasks:[
    {id:'p1',  label:'Ajouter le lien du compte à la prépa'},
    {id:'p2',  label:"Vérifier que l’Opportunité est bien en statut ‘Gagnée’"},
    {id:'p3',  label:'Vérifier que le nom de la société dans la prépa correspond au Nom de l’entreprise'},
    {id:'p4',  label:'Vérifier que l’adresse postale, le mail et le téléphone de l’entreprise sont bien présents dans la prépa'},
    {id:'p5',  label:'Vérifier que le champ nom de domaine définitif est bien rempli dans la fiche prépa'},
    {id:'p6',  label:'Vérifier que le lien de la démo (avec Token) est bien présent dans la prépa'},
    {id:'p7',  label:'Vérifier que les codes couleurs hexadécimaux du site sont bien présents dans la prépa (en cas d’absence les prendre du logo)'},
    {id:'p8',  label:"S’assurer que bloc entreprise fait partie des blocs de la page d’accueil (On ne crée pas une page entreprise séparée s’il s’agit d’une demo ; c’est une demande hors process)"},
    {id:'p9',  label:'Vérifier le nombre de TOP 10 est présent dans la prépa'},
    {id:'p10', label:'Vérifier le TOP 10 (sur l’opportunité) et la comparer aux mots clés et localités mentionnés sur la prépa'},
    {id:'p11', label:'S’il y a des options payantes mentionnées dans la prépa et non ajoutées aux produits sur Salesforce, continuer le traitement et mentionner tous les produits sur le mail récap'},
    {id:'p12', label:'Si mensualité SEO vendue mais produit non ajouté sur Salesforce, faire appel à l’assistante commerciale du Maroc avant de continuer'},
    {id:'p13', label:'Consulter le résumé de vente sur le compte client avant de solliciter les chefs de projet ou les commerciaux'},
  ]},
  { id:'mail', title:'Dans le mail', icon:'mail', color:'purple', tasks:[
    {id:'m1', label:'Lister les produits présents sur la prépa dans le mail récap sans modifier les produits sur Salesforce'},
  ]},
  { id:'projets', title:'Dans les projets', icon:'folder', color:'green', tasks:[
    {id:'pr1',  label:'Ajouter le nombre de TOP 10 contrat dans le Projet Site web'},
    {id:'pr2',  label:'Ajouter le nombre de TOP 10 contrat dans le Projet Maintenance SEO'},
    {id:'pr3',  label:"Ajouter le chef de projet sur le Projet Site web s’il n’est pas présent"},
    {id:'pr4',  label:"Ajouter le chef de projet sur le Projet Maintenance SEO s’il n’est pas présent"},
    {id:'pr5',  label:'Si pas de SEO vendu > Cocher la case “Pas de SEO” dans le Projet Site web'},
    {id:'pr6',  label:'Renommer le lot Site web en y ajoutant le nom du client'},
    {id:'pr7',  label:'Renommer le lot Maintenance édito en y ajoutant le nom du client'},
    {id:'pr8',  label:'Ajouter 2 dans le Nombre de jours vendus dans le lot SAV facturable'},
    {id:'pr9',  label:'Renommer le lot SAV non facturable en y ajoutant le nom du client'},
    {id:'pr10', label:"Renseigner le champ ‘sous-type’ du projet site web en précisant qu’il s’agit d’une démo"},
    {id:'pr11', label:'Cocher la case “Prépa validée” dans la fiche prépa du projet'},
  ]},
  { id:'lot', title:'Dans le lot', icon:'box', color:'blue', tasks:[
    {id:'l1', label:'Sélectionner le statut maquette (validée)'},
    {id:'l2', label:'Mettre le statut du projet sur “en cours” (attention à ne pas confondre avec étape du site)'},
    {id:'l3', label:'Ajouter votre imputation dans le lot site web avec traitement prépa'},
  ]},
];

var state = { tasks:{}, filter:'all', collapsed:{} };
SECTIONS.forEach(function(s){ s.tasks.forEach(function(t){ state.tasks[t.id] = 'idle'; }); });

function updateStats() {
  var total=0, done=0, ko=0;
  SECTIONS.forEach(function(s){ s.tasks.forEach(function(t){
    total++;
    if(state.tasks[t.id]==='checked') done++;
    if(state.tasks[t.id]==='ko') ko++;
  }); });
  var pending = total - done - ko;
  var pct = total>0 ? Math.round(done/total*100) : 0;
  document.getElementById('stat-total').textContent = total;
  document.getElementById('stat-done').textContent  = done;
  document.getElementById('stat-ko').textContent    = ko;
  document.getElementById('stat-pending').textContent = pending;
  document.getElementById('progress-bar').style.width = pct + '%';
  document.getElementById('progress-pct').textContent = pct + '%';
  document.getElementById('progress-count').textContent = done + ' / ' + total + ' tâches';
  var banner = document.getElementById('complete-banner');
  banner.classList.toggle('visible', done === total && total > 0 && ko === 0);
}

function toggleTask(taskId) {
  var cur = state.tasks[taskId];
  state.tasks[taskId] = cur === 'idle' ? 'checked' : 'idle';
  updateStats(); renderSections();
}
function toggleKo(taskId, e) {
  e.stopPropagation();
  state.tasks[taskId] = state.tasks[taskId] === 'ko' ? 'idle' : 'ko';
  updateStats(); renderSections();
}
function toggleSection(id) {
  state.collapsed[id] = !state.collapsed[id];
  renderSections();
}

function setFilter(f) {
  state.filter = f;
  ['all','pending','ko'].forEach(function(x){
    document.getElementById('tab-'+x).classList.toggle('active', x===f);
  });
  renderSections();
  verifFilter = f;
  if (verifInitialized) renderVerif();
}

var SVG_ICONS = {
  check: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>',
  mail:  '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>',
  folder:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>',
  box:   '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>',
  ko:    '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>',
  chevron:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>',
};
var DOT = { blue:'dot-blue', green:'dot-green', purple:'dot-purple', orange:'dot-orange', red:'dot-red' };

function renderSections() {
  var mainC = document.getElementById('sections-main');
  var mailC = document.getElementById('sections-mail');
  mainC.innerHTML = ''; mailC.innerHTML = '';

  SECTIONS.forEach(function(section) {
    var isMail = section.id === 'mail';
    var container = isMail ? mailC : mainC;
    var visible = section.tasks;
    if (state.filter === 'pending') visible = section.tasks.filter(function(t){ return state.tasks[t.id] === 'idle'; });
    if (state.filter === 'ko')      visible = section.tasks.filter(function(t){ return state.tasks[t.id] === 'ko'; });
    if (state.filter !== 'all' && visible.length === 0) return;

    var done = section.tasks.filter(function(t){ return state.tasks[t.id]==='checked'; }).length;
    var pct  = section.tasks.length > 0 ? Math.round(done/section.tasks.length*100) : 0;
    var isOpen = !state.collapsed[section.id];

    var div = document.createElement('div');
    div.className = 'card section-card';
    var headerHTML =
      '<button class="section-header" data-section="'+section.id+'">' +
        '<div class="section-header-left">' +
          '<span class="section-chevron'+(isOpen?' open':'')+'">'+SVG_ICONS.chevron+'</span>' +
          '<span class="section-title"><span class="color-dot '+DOT[section.color]+'"></span>'+SVG_ICONS[section.icon]+section.title+'</span>' +
        '</div>' +
        '<div class="section-header-right">' +
          '<span class="section-count">'+done+'/'+section.tasks.length+'</span>' +
          '<span class="section-pct">'+pct+'%</span>' +
        '</div>' +
      '</button>' +
      '<div class="section-body'+(isOpen?'':' hidden')+'">';
    var tasksHTML = '';
    visible.forEach(function(task) {
      var st = state.tasks[task.id];
      var isOk = st==='checked', isKo = st==='ko';
      tasksHTML +=
        '<div class="task-row'+(isKo?' ko-row':'')+'">' +
          '<div class="task-checkbox'+(isOk?' checked':isKo?' ko-state':'')+'" data-action="toggle" data-task="'+task.id+'"></div>' +
          '<span class="task-label'+(isOk?' done':isKo?' ko-label':'')+'" data-action="toggle" data-task="'+task.id+'">'+task.label+'</span>' +
          (isKo?'<span class="ko-badge">KO</span>':'')+
          '<button class="ko-btn'+(isKo?' active':'')+'" data-action="ko" data-task="'+task.id+'" title="Marquer KO">'+SVG_ICONS.ko+'</button>' +
        '</div>';
    });
    div.innerHTML = headerHTML + tasksHTML + '</div>';

    div.querySelectorAll('[data-action="toggle"]').forEach(function(el) {
      el.addEventListener('click', function() { toggleTask(this.dataset.task); });
    });
    div.querySelectorAll('[data-action="ko"]').forEach(function(el) {
      el.addEventListener('click', function(e) { toggleKo(this.dataset.task, e); });
    });
    div.querySelector('[data-section]').addEventListener('click', function() { toggleSection(this.dataset.section); });

    container.appendChild(div);
  });
}

// ══ Clipboard ══
function fallbackCopy(text, cb) {
  var ta = document.createElement('textarea');
  ta.value = text; ta.style.position = 'fixed'; ta.style.opacity = '0';
  document.body.appendChild(ta); ta.select();
  try { document.execCommand('copy'); if(cb) cb(); } catch(e){}
  document.body.removeChild(ta);
}
function copyBlock(id, btn) {
  var el = document.getElementById(id);
  var text = el.tagName === 'TEXTAREA' ? el.value : el.innerText;
  var origHTML = btn.innerHTML;
  var doneHTML = btn.innerHTML.replace(/Copier.*/,'Copié !');
  function showDone() {
    btn.innerHTML = doneHTML; btn.classList.add('copied');
    setTimeout(function(){ btn.innerHTML = origHTML; btn.classList.remove('copied'); }, 2000);
  }
  if (navigator.clipboard && window.isSecureContext) {
    navigator.clipboard.writeText(text).then(showDone).catch(function(){ fallbackCopy(text, showDone); });
  } else { fallbackCopy(text, showDone); }
}

// ══ Email PIN ══
var PIN_HASH = btoa('1234'.split('').map(function(c,i){return String.fromCharCode(c.charCodeAt(0)^(37+i));}).join(''));
var pinBuffer='', pinOverlay=null;
function checkPin(input) {
  var h = btoa(input.split('').map(function(c,i){return String.fromCharCode(c.charCodeAt(0)^(37+i));}).join(''));
  return h === PIN_HASH;
}
function openPinModal() {
  pinBuffer='';
  pinOverlay = document.createElement('div');
  pinOverlay.className = 'pin-overlay'; pinOverlay.id = 'pin-overlay';
  pinOverlay.innerHTML =
    '<div class="pin-modal">'+
      '<div class="pin-modal-header">'+
        '<div class="pin-modal-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg></div>'+
        '<div class="pin-modal-title">Accès protégé</div>'+
      '</div>'+
      '<div class="pin-modal-sub">Saisissez le code PIN pour afficher les adresses email des destinataires.</div>'+
      '<div class="pin-dots" id="pin-dots">'+
        '<div class="pin-dot" id="d0"></div><div class="pin-dot" id="d1"></div>'+
        '<div class="pin-dot" id="d2"></div><div class="pin-dot" id="d3"></div>'+
      '</div>'+
      '<div class="pin-pad">'+
        [1,2,3,4,5,6,7,8,9].map(function(n){ return '<button class="pin-key" data-n="'+n+'">'+n+'</button>'; }).join('')+
        '<button class="pin-key" style="visibility:hidden"></button>'+
        '<button class="pin-key" data-n="0">0</button>'+
        '<button class="pin-key del" data-del="1">⌫</button>'+
      '</div>'+
      '<div class="pin-error-msg" id="pin-error"></div>'+
      '<button class="pin-cancel" id="pin-cancel">Annuler</button>'+
    '</div>';
  document.body.appendChild(pinOverlay);
  pinOverlay.querySelectorAll('.pin-key[data-n]').forEach(function(btn){
    btn.addEventListener('click', function(){ pressKey(this.dataset.n); });
  });
  pinOverlay.querySelector('[data-del]').addEventListener('click', deleteKey);
  document.getElementById('pin-cancel').addEventListener('click', closePinModal);
  pinOverlay.addEventListener('click', function(e){ if(e.target===pinOverlay) closePinModal(); });
  document.addEventListener('keydown', handleKeydown);
}
function handleKeydown(e) {
  if(!pinOverlay) return;
  if(e.key>='0'&&e.key<='9') pressKey(e.key);
  if(e.key==='Backspace') deleteKey();
  if(e.key==='Escape') closePinModal();
}
function pressKey(n) {
  if(pinBuffer.length>=4) return;
  pinBuffer+=n; updateDots();
  if(pinBuffer.length===4) setTimeout(validatePin, 120);
}
function deleteKey() {
  pinBuffer=pinBuffer.slice(0,-1);
  document.getElementById('pin-error').textContent='';
  updateDots(false);
}
function updateDots(error) {
  for(var i=0;i<4;i++){
    var d=document.getElementById('d'+i);
    d.classList.toggle('filled',i<pinBuffer.length);
    d.classList.toggle('error',error===true);
  }
}
function validatePin() {
  if(checkPin(pinBuffer)){ closePinModal(); revealEmails(); }
  else {
    document.getElementById('pin-error').textContent='Code incorrect. Réessayez.';
    updateDots(true);
    setTimeout(function(){ pinBuffer=''; updateDots(false); document.getElementById('pin-error').textContent=''; }, 800);
  }
}
function closePinModal() {
  document.removeEventListener('keydown', handleKeydown);
  if(pinOverlay){ pinOverlay.remove(); pinOverlay=null; }
}
function decodeChip(a,b) {
  var raw = atob(a+b);
  return raw.split('').map(function(ch){ return String.fromCharCode(ch.charCodeAt(0)^0x5A); }).join('');
}
function revealEmails() {
  var svgCopy = '<svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="opacity:.5;flex-shrink:0"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>';
  document.querySelectorAll('.email-chip[data-a]').forEach(function(chip) {
    var email = decodeChip(chip.dataset.a, chip.dataset.b);
    chip.innerHTML = email + svgCopy;
    chip.title = 'Cliquer pour copier';
    chip.addEventListener('click', function(){ copyChip(this, email); });
  });
  document.getElementById('email-list').style.display = 'inline-flex';
  document.getElementById('reveal-emails-btn').style.display = 'none';
  document.getElementById('copy-emails-btn').addEventListener('click', copyAllEmails);
}
function copyChip(chip, email) {
  var svgCopy = '<svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="opacity:.5;flex-shrink:0"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>';
  var svgCheck = '<svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0"><polyline points="20 6 9 17 4 12"/></svg>';
  function showCopied() {
    chip.innerHTML = email + svgCheck; chip.classList.add('chip-copied');
    setTimeout(function(){ chip.innerHTML = email + svgCopy; chip.classList.remove('chip-copied'); }, 1800);
  }
  if(navigator.clipboard&&window.isSecureContext){ navigator.clipboard.writeText(email).then(showCopied).catch(function(){ fallbackCopy(email,showCopied); }); }
  else { fallbackCopy(email, showCopied); }
}
function copyAllEmails() {
  var emails=[];
  document.querySelectorAll('.email-chip[data-a]').forEach(function(chip){ emails.push(chip.textContent.replace(/[^\w@.\-]/g,'').trim()); });
  var text=emails.join('; ');
  var btn=document.getElementById('copy-emails-btn');
  var svgC='<svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>';
  var svgK='<svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>';
  function showCopied(){ btn.innerHTML=svgK+' Copié !'; btn.classList.add('copied'); setTimeout(function(){ btn.innerHTML=svgC+' Copier tous'; btn.classList.remove('copied'); },2000); }
  if(navigator.clipboard&&window.isSecureContext){ navigator.clipboard.writeText(text).then(showCopied).catch(function(){ fallbackCopy(text,showCopied); }); }
  else { fallbackCopy(text,showCopied); }
}
function hideEmails() {
  document.querySelectorAll('.email-chip[data-a]').forEach(function(chip){
    chip.innerHTML='•••'; chip.classList.remove('chip-copied'); chip.title='';
    chip.replaceWith(chip.cloneNode(true));
  });
  document.getElementById('email-list').style.display='none';
  document.getElementById('reveal-emails-btn').style.display='inline-flex';
}
document.getElementById('reveal-emails-btn').addEventListener('click', openPinModal);
document.getElementById('hide-emails-btn').addEventListener('click', hideEmails);
document.getElementById('copy-subject').addEventListener('click', function(){ copyBlock('email-subject', this); });
document.getElementById('copy-body').addEventListener('click', function(){ copyBlock('email-body', this); });
document.getElementById('tab-all').addEventListener('click', function(){ setFilter('all'); });
document.getElementById('tab-pending').addEventListener('click', function(){ setFilter('pending'); });
document.getElementById('tab-ko').addEventListener('click', function(){ setFilter('ko'); });
updateStats(); renderSections();

// ══════════════════════════════════════════════
// PAGE 2 — VÉRIFICATION SITE
// ══════════════════════════════════════════════
var VERIF_CATEGORIES = [
  { id:'verifications', label:'Vérifications communes', badge:'common', sections:[
    { id:'preparation', title:'Préparation', tasks:[
      { id:'prep-1', label:"S’assurer qu’il s’agit d’un site demo ou d’un site maquette" },
      { id:'prep-2', label:"Passer le site sur verif CDP en cours" },
      { id:'prep-3', label:"Ouvrir la maquette/démo + la prépa + site créé + ancien site" },
      { id:'prep-4', label:"Faire une lecture complète de la prépa et se rassurer que tous les éléments de la prépa existent sur le site" },
      { id:'prep-5', label:"Lire l’historique de tous les échanges sur le lot site web" },
    ]},
    { id:'design', title:'Design & Interface', tasks:[
      { id:'design-1', label:"Vérifier que le site correspond à la maquette/démo" },
      { id:'design-2', label:"Vérifier le responsive design (1440px, 1280px, 1024px, tablette, mobile) / Ne pas oublier de vérifier les pages des mentions légales, politique de confidentialité et CGV (pour les sites e-commerce)" },
    ]},
    { id:'contenu', title:'Contenu', tasks:[
      { id:'content-1', label:"Vérifier que les prestations, localité et mot clé primordiale sont respectés" },
      { id:'content-2', label:"Vérifier que les options payantes sont respectées" },
      { id:'content-3', label:"Vérifier que la mention de l’entreprise et informations de l’entreprise sont respectées" },
    ]},
    { id:'fonctionnalites', title:'Fonctionnalités', tasks:[
      { id:'func-1', label:"Vérifier que tous les CTA fonctionnent" },
      { id:'func-2', label:"Vérifier le bon fonctionnement des formulaires et l’adresse mail d’atterrissage" },
    ]},
    { id:'livraison-common', title:'Livraison', tasks:[
      { id:'liv-1', label:"Créer les identifiants WP client" },
      { id:'liv-2', label:"Ajouter les identifiants client dans le lot" },
      { id:'liv-3', label:"Cocher les cases vérif CDP + correction binôme" },
      { id:'liv-4', label:"Passer le statut du site vers à livrer" },
      { id:'liv-5', label:"Ajouter l’URL du site au compte client" },
      { id:'liv-6', label:"Ajouter le commentaire de livraison sur le compte en mentionnant le chef de projet, le commercial, l’assistante commerciale et l’agence (Revoir l’organigramme) en mettant le guide wordpress en PJ" },
    ]},
  ]},
  { id:'actions-ok', label:'Actions pour site OK', badge:'ok', conditional:'ok', sections:[
    { id:'livraison-ok', title:'Livraison', tasks:[
      { id:'ok-1', label:"Ajouter les identifiants client dans le lot" },
      { id:'ok-2', label:"Cocher les cases vérif CDP + correction binôme" },
      { id:'ok-3', label:"Passer le statut du site vers à livrer" },
      { id:'ok-4', label:"Ajouter l’URL du site au compte client" },
      { id:'ok-5', label:"Ajouter le commentaire de livraison sur le compte en mentionnant le chef de projet, le commercial, l’assistante commerciale et l’agence (Revoir l’organigramme) en mettant le guide wordpress en PJ" },
    ]},
  ]},
  { id:'actions-sav', label:'Actions pour SAV', badge:'sav', conditional:'sav', sections:[
    { id:'sav', title:'SAV', tasks:[
      { id:'sav-1', label:"Ajouter une nouvelle demande de SAV non facturable, et l’attribuer à TMA Qualité" },
      { id:'sav-2', label:"Ajouter un commentaire sur le lot Site web en mentionnant l’équipe et les responsables d’équipe ainsi que le lien de la requête" },
      { id:'sav-3', label:"Cocher la case vérification CDP" },
      { id:'sav-4', label:"Mettre le statut du site sur SAV avant livraison" },
    ]},
  ]},
];

var verifState = {}, verifCollapsed = {}, verifSiteStatus = 'ok', verifFilter = 'all', verifInitialized = false;
VERIF_CATEGORIES.forEach(function(cat){ cat.sections.forEach(function(sec){ sec.tasks.forEach(function(t){ verifState[t.id]=null; }); }); });

function verifStats() {
  var all=[];
  VERIF_CATEGORIES.forEach(function(cat){
    if(cat.conditional==='ok'  && verifSiteStatus!=='ok')  return;
    if(cat.conditional==='sav' && verifSiteStatus!=='sav') return;
    cat.sections.forEach(function(sec){ all=all.concat(sec.tasks); });
  });
  var total=all.length;
  var ok=all.filter(function(t){ return verifState[t.id]==='ok'; }).length;
  var ko=all.filter(function(t){ return verifState[t.id]==='ko'; }).length;
  return {total:total,ok:ok,ko:ko,pending:total-ok-ko,pct:total>0?Math.round(ok/total*100):0};
}
function setVerifTask(taskId,status) { verifState[taskId]=verifState[taskId]===status?null:status; renderVerif(); }
function toggleVerifSection(id) { verifCollapsed[id]=!verifCollapsed[id]; renderVerif(); }
function setVerifStatus(status) { verifSiteStatus=status; renderVerif(); }

function renderVerif() {
  var main = document.getElementById('verif-main');
  var s = verifStats();
  var allDone = s.ok+s.ko===s.total&&s.total>0;
  var SVG_CHK = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>';
  var html = '';

  // Info banner
  html += '<div class="info-banner"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg><div class="info-banner-items"><span>Vérifier chaque point avant de valider ou passer en SAV</span></div></div>';
  // Complete banner
  html += '<div class="verif-complete'+(allDone?' visible':'')+'">'+SVG_CHK+' Toutes les vérifications sont complétées !</div>';
  // Stats
  html += '<div class="stats-grid">';
  html += '<div class="stat-card"><div class="stat-label"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>Total</div><div class="stat-value c-gray">'+s.total+'</div></div>';
  html += '<div class="stat-card"><div class="stat-label"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>Validées</div><div class="stat-value c-green">'+s.ok+'</div></div>';
  html += '<div class="stat-card"><div class="stat-label" style="color:var(--red)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>KO</div><div class="stat-value c-red">'+s.ko+'</div></div>';
  html += '<div class="stat-card"><div class="stat-label"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>En attente</div><div class="stat-value c-orange">'+s.pending+'</div></div>';
  html += '</div>';
  // Progress
  html += '<div class="card progress-card"><div class="progress-header"><span class="progress-title"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>Progression globale</span><span class="progress-count">'+s.ok+' / '+s.total+' tâches</span></div><div class="progress-bar-bg"><div class="progress-bar-fill" style="width:'+s.pct+'%"></div></div><div class="progress-pct">'+s.pct+'%</div></div>';
  // Status toggle — same pill style as filter-tabs
  html += '<div class="card status-card">';
  html += '<div class="status-card-title">Statut du site après vérification</div>';
  html += '<div class="filter-tabs" style="width:fit-content">';
  html += '<button class="filter-tab'+(verifSiteStatus==='ok'?' active':'')+'" data-vstatus="ok"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:13px;height:13px;color:var(--green)"><polyline points="20 6 9 17 4 12"/></svg>Site OK — Prêt à livrer</button>';
  html += '<button class="filter-tab'+(verifSiteStatus==='sav'?' active':'')+'" data-vstatus="sav"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:13px;height:13px;color:var(--red)"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>SAV requis</button>';
  html += '</div></div>';

  // Categories & sections
  VERIF_CATEGORIES.forEach(function(cat) {
    if(cat.conditional==='ok'&&verifSiteStatus!=='ok') return;
    if(cat.conditional==='sav'&&verifSiteStatus!=='sav') return;
    var dotClass = cat.badge==='ok'?'dot-green':cat.badge==='sav'?'dot-red':'dot-blue';
    cat.sections.forEach(function(sec) {
      var visibleTasks = sec.tasks;
      if(verifFilter==='pending') visibleTasks=sec.tasks.filter(function(t){ return verifState[t.id]===null; });
      if(verifFilter==='ko')      visibleTasks=sec.tasks.filter(function(t){ return verifState[t.id]==='ko'; });
      if(verifFilter!=='all'&&visibleTasks.length===0) return;
      var doneCount=sec.tasks.filter(function(t){ return verifState[t.id]!==null; }).length;
      var pct=sec.tasks.length>0?Math.round(doneCount/sec.tasks.length*100):0;
      var isOpen=!verifCollapsed[sec.id];
      html += '<div class="card section-card">';
      html += '<button class="section-header" data-vsec="'+sec.id+'">';
      html += '<div class="section-header-left"><span class="section-chevron'+(isOpen?' open':'')+'">'+SVG_ICONS.chevron+'</span><span class="section-title"><span class="color-dot '+dotClass+'"></span>'+sec.title+'</span>';
      html += '<span style="font-size:11px;color:var(--muted)">'+cat.label+'</span></div>';
      html += '<div class="section-header-right"><span class="section-count">'+doneCount+'/'+sec.tasks.length+'</span><span class="section-pct">'+pct+'%</span></div>';
      html += '</button>';
      html += '<div class="section-body'+(isOpen?'':' hidden')+'">';
      visibleTasks.forEach(function(task) {
        var st=verifState[task.id];
        var isOk=st==='ok', isKo=st==='ko';
        html += '<div class="task-row'+(isKo?' ko-row':'')+'">';
        html += '<div class="task-checkbox'+(isOk?' checked':isKo?' ko-state':'')+'" data-vtask="'+task.id+'" data-vval="ok"></div>';
        html += '<span class="task-label'+(isOk?' done':isKo?' ko-label':'')+'" data-vtask="'+task.id+'" data-vval="ok">'+task.label+'</span>';
        if(isKo) html += '<span class="ko-badge">KO</span>';
        html += '<button class="ko-btn'+(isKo?' active':'')+'" data-vtask="'+task.id+'" data-vval="ko" title="Marquer KO">'+SVG_ICONS.ko+'</button>';
        html += '</div>';
      });
      html += '</div></div>';
    });
  });

  // Organigramme
  html += '<div class="card orga-card"><div><div class="orga-text" style="font-weight:700;margin-bottom:3px">Organigramme équipe</div><div class="orga-text" style="font-size:12px;opacity:.8">Retrouver les contacts et la hiérarchie</div></div><a class="orga-btn" href="https://www.canva.com/design/DAGskIOHERg/DZjfHrflj8TmU8BZ7iL3OA/edit" target="_blank"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>Ouvrir l’organigramme</a></div>';

  main.innerHTML = html;

  // Commentaire de livraison (built with DOM to avoid encoding issues)
  var livraisonCard = document.createElement('div');
  livraisonCard.className = 'card email-card';
  livraisonCard.innerHTML = [
    '<div class="card-title">',
      '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>',
      'Commentaire de livraison',
    '</div>',
    '<div class="card-sub">',
      '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>',
      'Contenu du message',
    '</div>',
    '<div class="mono-wrap">',
      '<div class="mono-block" id="verif-msg-display"></div>',
      '<textarea class="mono-block" id="verif-msg-body" style="display:none;resize:none;height:0;overflow:hidden" readonly></textarea>',
      '<button class="copy-btn" id="copy-verif-msg">',
        '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>',
        'Copier',
      '</button>',
    '</div>'
  ].join('');
  var plainMsg = 'Bonjour, \uD83D\uDC4B\n\n@Propri\u00E9taire_du_compte @Chef_de_projet @Coordinateur @Assistante_Commerciale @Agence\n\nSite produit et pr\u00EAt pour livraison :\n\n\u2022 ID : \n\u2022 MDP : \n\u2022 URL :\n\u2022 Mail :\n\nGuide WP en PJ et lien mis \u00E0 jour';
  livraisonCard.querySelector('#verif-msg-body').value = plainMsg;
  var displayDiv = livraisonCard.querySelector('#verif-msg-display');
  displayDiv.innerHTML =
    'Bonjour, \uD83D\uDC4B\n\n' +
    '@Propri\u00E9taire_du_compte @Chef_de_projet @Coordinateur @Assistante_Commerciale @Agence\n\n' +
    'Site produit et pr\u00EAt pour livraison :\n\n' +
    '<span class="bullet-item">\u2022 ID : </span>' +
    '<span class="bullet-item">\u2022 MDP : </span>' +
    '<span class="bullet-item">\u2022 URL :</span>' +
    '<span class="bullet-item">\u2022 Mail :</span>' +
    '\nGuide WP en PJ et lien mis \u00E0 jour';
  livraisonCard.querySelector('#copy-verif-msg').addEventListener('click', function() { copyBlock('verif-msg-body', this); });
  main.appendChild(livraisonCard);

  // Footer
  var footer = document.createElement('div');
  footer.className = 'footer';
  footer.textContent = '© 2026 Cohérence Maintenance — Outils de maintenance et développement';
  main.appendChild(footer);

  // Bind events
  main.querySelectorAll('[data-vsec]').forEach(function(el) {
    el.addEventListener('click', function(e){ e.stopPropagation(); toggleVerifSection(this.dataset.vsec); });
  });
  main.querySelectorAll('[data-vtask]').forEach(function(el) {
    el.addEventListener('click', function(e){ e.stopPropagation(); setVerifTask(this.dataset.vtask, this.dataset.vval); });
  });
  main.querySelectorAll('[data-vstatus]').forEach(function(el) {
    el.addEventListener('click', function(){ setVerifStatus(this.dataset.vstatus); });
  });
}

function initVerif() { renderVerif(); }
</script>
</body>
</html>
